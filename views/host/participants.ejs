<%- include('../partials/header-layout') %>

<style>
  .participants-shell {
    max-width: 1200px;
    margin: 2.5rem auto 3rem;
    padding: 0 1.5rem;
  }

  .back-link {
    display: inline-block;
    margin-bottom: 1.5rem;
  }

  .event-info {
    background: #ffffff;
    padding: 2rem;
    border-radius: 20px;
    box-shadow: 0 4px 20px rgba(15, 23, 42, 0.08);
    border: 1px solid #e5e7eb;
    margin-bottom: 2rem;
  }

  .event-info h1 {
    margin-bottom: 0.75rem;
    font-size: 1.75rem;
    font-weight: 700;
    color: #111827;
  }

  .event-info p {
    color: #6b7280;
    margin: 0.3rem 0;
    font-size: 0.95rem;
  }

  .event-info strong {
    color: #111827;
    font-weight: 600;
  }

  .section-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 1.5rem;
    flex-wrap: wrap;
    gap: 1rem;
  }

  .section-header h2 {
    font-size: 1.4rem;
    font-weight: 700;
    color: #111827;
  }

  .participants-table-container {
    background: white;
    border-radius: 18px;
    box-shadow: 0 4px 16px rgba(15, 23, 42, 0.06);
    border: 1px solid #e5e7eb;
    overflow: hidden;
  }

  table {
    width: 100%;
    border-collapse: collapse;
  }

  thead {
    background: #f9fafb;
    border-bottom: 2px solid #e5e7eb;
  }

  th {
    padding: 1rem 1.25rem;
    text-align: left;
    font-weight: 600;
    color: #374151;
    font-size: 0.85rem;
    text-transform: uppercase;
    letter-spacing: 0.05em;
  }

  td {
    padding: 1.1rem 1.25rem;
    border-bottom: 1px solid #f3f4f6;
    color: #4b5563;
    font-size: 0.95rem;
  }

  tbody tr {
    transition: background 0.2s;
  }

  tbody tr:hover {
    background: #f9fafb;
  }

  tbody tr:last-child td {
    border-bottom: none;
  }

  .no-participants {
    text-align: center;
    padding: 4rem 2rem;
    background: white;
    border-radius: 18px;
    box-shadow: 0 4px 16px rgba(15, 23, 42, 0.06);
    border: 1px solid #e5e7eb;
  }

  .no-participants h3 {
    color: #6b7280;
    margin-bottom: 1rem;
    font-size: 1.4rem;
  }

  .no-participants p {
    color: #9ca3af;
    font-size: 0.95rem;
  }

  @media (max-width: 768px) {
    .participants-table-container {
      overflow-x: auto;
    }

    table {
      min-width: 600px;
    }
  }
</style>

<div class="participants-shell">
  <a href="/host/dashboard" class="btn btn-secondary back-link"
    >‚Üê Back to Host Dashboard</a
  >

  <div class="event-info">
    <h1><%= event.title %></h1>
    <p>
      <%= new Date(event.start_datetime).toLocaleString() %> | <%=
      event.location %>
    </p>
    <p style="margin-top: 1rem">
      <strong>Total Participants: <%= participants.length %></strong>
    </p>
  </div>

  <div class="section-header">
    <h2>Registered Participants</h2>
    <% if (participants.length > 0) { %>
    <button onclick="exportToCSV()" class="btn btn-success">
      Download CSV
    </button>
    <% } %>
  </div>

  <% if (participants.length === 0) { %>
  <div class="no-participants">
    <h3>No participants yet</h3>
    <p>When people register for your event, they'll appear here.</p>
  </div>
  <% } else { %>
  <div class="participants-table-container">
    <table id="participantsTable">
      <thead>
        <tr>
          <th>#</th>
          <th>Name</th>
          <th>Email</th>
          <th>Registration Date</th>
        </tr>
      </thead>
      <tbody>
        <% participants.forEach((participant, index) => { %>
        <tr>
          <td><%= index + 1 %></td>
          <td>
            <strong style="color: #111827"><%= participant.name %></strong>
          </td>
          <td><%= participant.email %></td>
          <td><%= new Date(participant.registered_at).toLocaleString() %></td>
        </tr>
        <% }); %>
      </tbody>
    </table>
  </div>

  <script>
    function exportToCSV() {
      const table = document.getElementById("participantsTable");
      let csv = [];

      const headers = Array.from(table.querySelectorAll("thead th")).map(
        (th) => th.textContent
      );
      csv.push(headers.join(","));

      const rows = table.querySelectorAll("tbody tr");
      rows.forEach((row) => {
        const cols = Array.from(row.querySelectorAll("td")).map((td) => {
          let text = td.textContent.trim();
          if (text.includes(",") || text.includes('"')) {
            text = '"' + text.replace(/"/g, '""') + '"';
          }
          return text;
        });
        csv.push(cols.join(","));
      });

      const csvContent = csv.join("\n");
      const blob = new Blob([csvContent], { type: "text/csv" });
      const url = window.URL.createObjectURL(blob);
      const a = document.createElement("a");
      a.href = url;
      const eventTitle =
        '<%= event.title.replace(/[^a-z0-9]/gi, "_").toLowerCase() %>';
      a.download = eventTitle + "_participants.csv";
      a.click();
      window.URL.revokeObjectURL(url);
    }
  </script>
  <% } %>
</div>

<%- include('../partials/footer-layout') %>
